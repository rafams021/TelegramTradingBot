<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Bot Analytics Dashboard v2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 0.9em;
            text-transform: uppercase;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
        }

        .stat-card .subtext {
            color: #888;
            font-size: 0.85em;
            margin-top: 5px;
        }

        .positive {
            color: #10b981 !important;
        }

        .negative {
            color: #ef4444 !important;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .chart-container h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            color: #667eea;
            font-weight: 600;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge.success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge.danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .refresh-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ðŸ¤– Trading Bot Analytics</h1>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Win Rate</h3>
                <div class="value positive" id="win-rate">--</div>
                <div class="subtext">Overall Performance</div>
            </div>

            <div class="stat-card">
                <h3>Total Signals</h3>
                <div class="value" id="total-signals">--</div>
                <div class="subtext">Received Today</div>
            </div>

            <div class="stat-card">
                <h3>Executed</h3>
                <div class="value positive" id="executed">--</div>
                <div class="subtext">Orders Placed</div>
            </div>

            <div class="stat-card">
                <h3>Skipped</h3>
                <div class="value negative" id="skipped">--</div>
                <div class="subtext">Out of Range</div>
            </div>

            <div class="stat-card">
                <h3>Avg Latency</h3>
                <div class="value" id="latency">--</div>
                <div class="subtext">Milliseconds</div>
            </div>

            <div class="stat-card">
                <h3>PnL (Pips)</h3>
                <div class="value" id="pnl-pips">--</div>
                <div class="subtext">Today's Profit</div>
            </div>

            <div class="stat-card">
                <h3>BUY Win Rate</h3>
                <div class="value" id="buy-wr">--</div>
                <div class="subtext">Long Positions</div>
            </div>

            <div class="stat-card">
                <h3>SELL Win Rate</h3>
                <div class="value" id="sell-wr">--</div>
                <div class="subtext">Short Positions</div>
            </div>
        </div>

        <div class="chart-container">
            <h2>ðŸ“Š Recent Signals</h2>
            <button class="refresh-btn" onclick="loadData()">ðŸ”„ Refresh</button>
            <table id="signals-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Side</th>
                        <th>Entry</th>
                        <th>Mode</th>
                        <th>Splits</th>
                        <th>Status</th>
                        <th>Latency</th>
                    </tr>
                </thead>
                <tbody id="signals-body">
                    <tr>
                        <td colspan="7" style="text-align: center;">Loading...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="chart-container">
            <h2>ðŸŽ¯ Skip Reasons Breakdown</h2>
            <table id="skip-table">
                <thead>
                    <tr>
                        <th>Reason</th>
                        <th>Count</th>
                        <th>Percentage</th>
                    </tr>
                </thead>
                <tbody id="skip-body">
                    <tr>
                        <td colspan="3" style="text-align: center;">Loading...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Simular datos (en producciÃ³n, esto vendrÃ­a de una API)
        function loadData() {
            // Parse trading_metrics.jsonl
            fetch('trading_metrics.jsonl')
                .then(response => response.text())
                .then(data => {
                    const lines = data.trim().split('\n');
                    const metrics = lines.map(line => JSON.parse(line));

                    updateDashboard(metrics);
                })
                .catch(err => {
                    console.error('Error loading data:', err);
                    // Fallback: usar datos de ejemplo
                    updateDashboardWithMockData();
                });
        }

        function updateDashboard(metrics) {
            // Filtrar signals y positions
            const signals = metrics.filter(m => m.type === 'signal');
            const positions = metrics.filter(m => m.type === 'position');

            // Stats
            const executed = signals.filter(s => s.status === 'EXECUTED').length;
            const skipped = signals.filter(s => s.status === 'SKIPPED').length;

            const closedPositions = positions.filter(p =>
                p.status === 'TP_HIT' || p.status === 'SL_HIT'
            );
            const tpHit = positions.filter(p => p.status === 'TP_HIT').length;
            const winRate = closedPositions.length > 0
                ? (tpHit / closedPositions.length * 100).toFixed(1)
                : 0;

            // Update UI
            document.getElementById('win-rate').textContent = winRate + '%';
            document.getElementById('total-signals').textContent = signals.length;
            document.getElementById('executed').textContent = executed;
            document.getElementById('skipped').textContent = skipped;

            // Latency
            const latencies = signals
                .filter(s => s.execution_time_ms)
                .map(s => s.execution_time_ms);
            const avgLatency = latencies.length > 0
                ? (latencies.reduce((a, b) => a + b, 0) / latencies.length).toFixed(0)
                : '--';
            document.getElementById('latency').textContent = avgLatency + 'ms';

            // PnL
            const totalPnl = positions
                .filter(p => p.pnl_pips)
                .reduce((sum, p) => sum + p.pnl_pips, 0)
                .toFixed(1);
            document.getElementById('pnl-pips').textContent = totalPnl;

            // Update table
            updateSignalsTable(signals.slice(-10).reverse());
        }

        function updateDashboardWithMockData() {
            document.getElementById('win-rate').textContent = '68.5%';
            document.getElementById('total-signals').textContent = '47';
            document.getElementById('executed').textContent = '42';
            document.getElementById('skipped').textContent = '5';
            document.getElementById('latency').textContent = '234ms';
            document.getElementById('pnl-pips').textContent = '+127.5';
            document.getElementById('buy-wr').textContent = '72.0%';
            document.getElementById('sell-wr').textContent = '65.0%';
        }

        function updateSignalsTable(signals) {
            const tbody = document.getElementById('signals-body');
            tbody.innerHTML = signals.map(s => `
                <tr>
                    <td>${new Date(s.timestamp).toLocaleTimeString()}</td>
                    <td><span class="badge ${s.side === 'BUY' ? 'success' : 'danger'}">${s.side}</span></td>
                    <td>${s.entry.toFixed(2)}</td>
                    <td>${s.execution_mode}</td>
                    <td>${s.executed_splits}/${s.num_splits}</td>
                    <td><span class="badge ${s.status === 'EXECUTED' ? 'success' :
                    s.status === 'SKIPPED' ? 'warning' : 'danger'
                }">${s.status}</span></td>
                    <td>${s.execution_time_ms ? s.execution_time_ms.toFixed(0) + 'ms' : '--'}</td>
                </tr>
            `).join('');
        }

        // Auto-refresh every 10 seconds
        setInterval(loadData, 10000);

        // Initial load
        loadData();
    </script>
</body>

</html>